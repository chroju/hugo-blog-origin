+++
categories = ["ruby", "Google api"]
comments = true
date = "2015-05-03T00:00:00+09:00"
title = "Hash与えるとGoogleスプレッドシートに入力してくれるRubyスクリプト"

+++

<script src="https://gist.github.com/chroju/7b9d422732f1a0ddd45e.js"></script>

つくった。動きとしては、項目名と入力値からなるハッシュを引数で与えてやることで、該当スプレッドシートの2列目に符合するキーがある場合、その値を一番右側の列に入力してくれる。符合するキーがない場合は、メッセージを吐いた上で最下行に新しい項目として追加する。

用途としては非常に個人的なもので、各種オンラインバンクの残高をスクレイピングしてハッシュで返してくれるスクリプトをいくつか作ってあったので、その戻り値を使ってオートで家計簿作れたらいいなーという思いによるものです。ハッシュのキーをそのままスプレッドシート内の項目名として使っているので、シンボルではなく文字列をキーとして使ってしまっているのがあまりよろしくないのかなぁとは思うのだが、いつか改善するってーことで、とりあえず動くものを作ることを優先させた。んで、これって結構汎用的に使えそうなスクリプトかもなと思って公開した次第。

Googleスプレッドシートをいじるのには`google-drive-ruby`というGemを使ってます。Githubは[ここ](https://github.com/gimite/google-drive-ruby)。`def initialize`内の処理は、このGemの初期設定によるものなので、Gemの方のReadme読んでもらえればよいかと。単純な話、GoogleのOAuth API使っているだけの話です。ただ、このコードだと叩くたびにブラウザからAPI使用許可を与えてやって、success codeをコピーしてコマンドラインで入力してやらなくちゃならないっていう手間があって、そこまで省く方法なにかありそうだけどまだ調べてない。あと気になっている点としては、このGemでセルの値を取ると、表示値しか取れないこと。式を入れているセルについては、式を取るか表示値を取るか選べるといいなぁと思ったんだけど、そこまではできないらしい。しかしまぁ、とにかくGoogleスプレッドシートという、APIで叩けるクラウドの表計算ソフトがあるというのは本当に便利なことですね、って感じ。

## 参考
- [RubyからGoogle SpreadSheet をいじるメモ - Qiita](http://qiita.com/inokappa/items/2566b21f4b1deac6f95b)
- [Google DriveのスプレッドシートにRubyでアクセスする方法 - Qiita](http://qiita.com/yumiyon/items/d7c370b3b8582431a3de)

